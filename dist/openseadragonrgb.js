!function(e){"use strict";function t(e){this.onCanvasHover(this.getValueAround(e.position))}if(!e.version||e.version.major<2)throw new Error("This version of OpenSeadragonRGB requires OpenSeadragon version 2.0.0+");e.Viewer.prototype.rgb=function(t){return this.rgbInstance&&!t||(t=t||{},t.viewer=this,this.rgbInstance=new e.RGB(t)),this.rgbInstance},e.RGB=function(r){e.extend(!0,this,{viewer:null,onCanvasHover:null,sampleSize:1},r),this.onCanvasHover&&(this.tracker=new e.MouseTracker({element:this.viewer.canvas,moveHandler:e.delegate(this,t)}))},e.extend(e.RGB.prototype,{getValueAt:function(t,r){var n=1===arguments.length?t:new e.Point(t,r),o=this.viewer,a=o.drawer.getRgbAt(n);if(a)for(var i,s,g,u=0;u<o.world.getItemCount();u++)i=o.world.getItemAt(u),g=i.getContentSize(),s=e.TiledImage.prototype.viewerElementToImageCoordinates?i.viewerElementToImageCoordinates(n):o.viewport.viewerElementToImageCoordinates(n),s.x>=0&&s.y>=0&&s.x<=g.x&&s.y<=g.y&&(a.image=i,a.imageCoordinates=s);return a},getValueAround:function(t,r){for(var n=1===arguments.length?t:new e.Point(t,r),o=this.viewer,a=[],i=0;i<o.world.getItemCount();i++)a.push(o.world.getItemAt(i));for(var s,i=0;i<a.length&&(s=a[i],!o.drawer.pointIsInImage(n,s));i++);for(var g=o.drawer.getEyeDrop(n,o.rgbInstance.sampleSize),u=[],i=0;i<g.length;i++)u.push(o.drawer.getRgbAt(g[i]));for(var l=[],v=[],h=[],p=[],i=0;i<u.length;i++)l.push(u[i].r),v.push(u[i].g),h.push(u[i].b),p.push(u[i].a);var w=function(e){e.sort(function(e,t){return e-t});var t=e[Math.floor(e.length/2)];return console.log("channelValues "+JSON.stringify(e)+" median: "+JSON.stringify(t)),t},d={r:w(l),g:w(v),b:w(h),a:w(p)};return console.log("color "+JSON.stringify(d)),s&&(d.image=s,d.imageCoordinates=n),d}}),e.Drawer.prototype.pointIsInImage=function(e,t){var r=t.getContentSize(),n=e.x>=0&&e.y>=0;return n=n&&e.x<=r.x&&e.y<=r.y},e.Drawer.prototype.getRgbAt=function(t){if(!this.useCanvas)return!1;var r=e.pixelDensityRatio,n=this._getContext().getImageData(t.x*r,t.y*r,1,1).data;return{r:n[0],g:n[1],b:n[2],a:n[3]}},e.Drawer.prototype.getEyeDrop=function(t,r){for(var n=[],o=(r-1)/2,a=0-o;a<=o;a++)for(var i=0-o;i<=o;i++){var s=new e.Point(t.x+a,t.y+i);t.distanceTo(s)<=o&&n.push(s)}return n}}(OpenSeadragon);
//# sourceMappingURL=openseadragonrgb.js.map
